<div class="gradient-bg">
    <section class="container p-3">
        <div class="row">
           <div class="col-lg-5">
               <div class="p-1 rounded-0 border-1 border-dark">
                   <!-- Products List -->
                   <div class="overflow-auto p-2" >
                       <div *ngIf="products.getValue().length === 0" class="text-center p-4">
                           <img class="img-fluid mb-3" src="/empty_basket.jpeg" alt="Empty Basket">
                           <h1 class="text-secondary fs-3">Panier est vide</h1>
                           <hr>
                           <hr>
                           <hr>
                       </div>
                       <div *ngFor="let product of products | async; trackBy: trackByProduct" class="card mb-2">
                           <div mat-card class="row g-0">
                               <!-- Product image -->
                               <div class="col-3 p-2">
                                   <img src="/product.jpeg"  class="img-fluid rounded-start" alt="Produit">
                               </div>

                               <!-- Product info -->
                               <div class="col-7">
                                   <div class="card-body">
                                       <p class="card-title fs-4  fw-bold mb-2">{{ product.product.name }}</p>
                                       <small class="d-block ">Quantité: <strong class="text-dark mx-1">{{ product.quantity }}</strong></small>
                                       <small class="d-block ">Prix: {{ product.product.price }} MAD</small>
                                   </div>
                               </div>

                               <!-- Controls -->
                               <div class="col-2 d-flex flex-column justify-content-between p-2">
                                   <button mat-icon-button (click)="removeFromBasket(product)" class="btn bg-light text-dark-emphasis text-end scale-08 mb-1"><mat-icon>delete</mat-icon></button>
                                   <button mat-icon-button (click)="increaseQuantity(product)" class="btn bg-light text-success scale-08 rounded-4 mb-1"> <mat-icon>add</mat-icon></button>
                                   <button mat-icon-button (click)="decreaseQuantity(product)" class="btn bg-light text-danger scale-08 rounded-4"><mat-icon>remove</mat-icon></button>
                               </div>
                           </div>
                       </div>
                   </div>

               </div>
           </div>
            <div class="col-lg-7 p-2">
                <h3> <strong>Total</strong> : {{ parseInt(totalAmount).toFixed(2) }} MAD</h3>
                <mat-accordion class="example-headers-align p-2">
                    <mat-expansion-panel [expanded]="step() === 0" (opened)="setStep(0)" hideToggle>
                        <mat-expansion-panel-header>
                            <mat-panel-title> Produits </mat-panel-title>
                            <mat-panel-description>
                                Valider les produits
                                <button mat-button (click)="nextStep()" [disabled]="(products | async)?.length === 0">Procéder au paiement</button>
                            </mat-panel-description>
                        </mat-expansion-panel-header>
                        <mat-action-row>
                            <button mat-button (click)="nextStep()">suivante</button>
                        </mat-action-row>
                    </mat-expansion-panel>

                    <mat-expansion-panel [expanded]="step() === 1" (opened)="setStep(1)" hideToggle>
                        <mat-expansion-panel-header>
                            <mat-panel-title> Destination </mat-panel-title>
                            <mat-panel-description>
                                Information de livraison & facturation
                                <mat-icon>map</mat-icon>
                            </mat-panel-description>
                        </mat-expansion-panel-header>



                        <form [formGroup]="checkoutForm" class="row g-3 p-3">
                            <div class="col-md-6">
                                <label class="form-label">Nom complet</label>
                                <input type="text" class="form-control" formControlName="fullName" placeholder="Ex: Jean Dupont">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Téléphone</label>
                                <input type="tel" class="form-control" formControlName="phone" placeholder="Ex: +212 6 12 34 56 78">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Adresse</label>
                                <input type="text" class="form-control" formControlName="address" placeholder="Rue, N°, Appartement">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Ville</label>
                                <input type="text" class="form-control" formControlName="city" placeholder="Casablanca">
                            </div>
                            <div class="col-12">
                                <label class="form-label">Notes</label>
                                <textarea rows="3" class="form-control" formControlName="notes" placeholder="Instructions de livraison"></textarea>
                            </div>
                        </form>
                        <mat-action-row>
                            <button mat-button (click)="prevStep()">Previous</button>
                            <button mat-button (click)="nextStep()" [disabled]="checkoutForm.invalid">suivante</button>
                        </mat-action-row>
                    </mat-expansion-panel>

                    <mat-expansion-panel [expanded]="step() === 2" (opened)="setStep(2)" hideToggle>
                        <mat-expansion-panel-header>
                            <mat-panel-title> Paiement </mat-panel-title>
                            <mat-panel-description>
                                Inform the date you wish to travel
                                <mat-icon>date_range</mat-icon>
                            </mat-panel-description>
                        </mat-expansion-panel-header>

                        <div class="p-3">
                            <div class="mb-3">
                                <label class="form-label d-block">Méthode de paiement</label>
                                <div class="d-flex gap-3">
                                    <button type="button" class="btn" [class.btn-dark]="selectedPaymentMethod==='COD'" [class.btn-outline-dark]="selectedPaymentMethod!=='COD'" (click)="selectedPaymentMethod='COD'">Paiement à la livraison</button>
                                    <button type="button" class="btn" [class.btn-success]="selectedPaymentMethod==='WHATSAPP'" [class.btn-outline-success]="selectedPaymentMethod!=='WHATSAPP'" (click)="selectedPaymentMethod='WHATSAPP'">Confirmer via WhatsApp</button>
                                </div>
                            </div>

                            <div class="alert alert-danger" *ngIf="submitError">{{ submitError }}</div>
                            <div class="alert alert-success" *ngIf="submitSuccess">{{ submitSuccess }}</div>

                            <button class="btn btn-primary" (click)="submitOrder()" [disabled]="isSubmitting || (products | async)?.length === 0">
                                <span *ngIf="!isSubmitting">Confirmer la commande</span>
                                <span *ngIf="isSubmitting">Envoi en cours...</span>
                            </button>
                        </div>

                        <mat-action-row>
                            <button mat-button (click)="prevStep()">Previous</button>
                        </mat-action-row>
                    </mat-expansion-panel>
                </mat-accordion>
            </div>
        </div>

    </section>
    <app-footer></app-footer>
</div>